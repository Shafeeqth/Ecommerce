<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>CartFy Category</title>
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <meta name="description" content="" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta property="og:title" content="" />
    <meta property="og:type" content="" />
    <meta property="og:url" content="" />
    <meta property="og:image" content="" />
    <!-- Favicon -->
    <link
      rel="shortcut icon"
      type="image/x-icon"
      href="assets/imgs/theme/favicon.svg"
    />
    <!-- Template CSS -->
    <link href="/assets/css/main.css?v=1.1" rel="stylesheet" type="text/css" />

    <style>
      body {
        font-family: Arial, sans-serif;
      }

      .POPUP {
        width: 600px;
        height: 200px;
        display: none;
        position: absolute;

        justify-content: center;
        align-items: center;
      }

      .popup-content {
        background-color: #474141;
        padding: 10rem;
        border-radius: 5px;
        /* margin-bottom: 10rem; */
      }

      .close-btn {
        background-color: #007bff;
        color: #fff;
        border: none;
        padding: 5px 10px;
        cursor: pointer;
        border-radius: 5px;
      }
    </style>
  </head>

  <body >
    <div id="AreaReload">
    <%- include('../partials/sidenav.ejs') -%>

    <main class="main-wrap" >
      <section class="content-main"  >
        <div class="content-header col-4">
          <h2 class="content-title">Cetagory</h2>
        </div>
        <div class="card">
          <div class="card-body">
            <div class="row">
              <div class="col-lg-12">
                <header class="border-bottom mb-4 pb-4">
                  <div class="row">
                    <div class="col-lg-2 col-6">
                      <a class="btn btn-sm btn-dark" href="admin/category/add-category">
                        Add category
                      </a>
                    </div>
                    <div id="myModal" class="POPUP">
                      <div class="popup-content">
                        <span class="close-btn" 
                          >&times;</span
                        >
                        <h2 class="mt-2 text-success">Add your wish</h2>
                        <input
                          type="text"
                          class="form-control mt-2 text-primary"
                          name="category"
                          id="messageInput"
                          placeholder="Add catagory"
                        />
                        <button
                          onclick="sendMessage()"
                          class="btn btn-sm btn-primary text-end mt-2"
                        >
                          Add
                        </button>
                      </div>
                    </div>
                    <div id="editmodal" class="POPUP">
                      <div class="popup-content">
                        <span class="close-btn" onclick="closeUpdate()"
                          >&times;</span
                        >
                        <h2 class="mt-2 text-success">Add your wish</h2>
                        <input type="text" hidden value="" id="id" />
                        <input
                          type="text"
                          class="form-control mt-2 text-primary"
                          name="cetegory"
                          id="editFeild"
                        />
                        <button
                          onclick="editCetagory()"
                          class="btn btn-sm btn-primary text-end mt-2"
                        >
                          update
                        </button>
                      </div>
                    </div>
                  </div>
                </header>
                <!-- card-header end// -->
                <div class="table-responsive">
                  <table class="table table-hover" id="catTable">
                    <thead>
                      <tr>
                        <th>SL. No.</th>
                        <th>Category</th>
                        <th>Desctiption</th>
                        <th class="text-end">Action</th>
                      </tr>
                    </thead>
                    <tbody>

                      <% if(Array.isArray(categories) && categories.length > 0 ) {%>
                        
                       <% categories.forEach((category, index) => {%>
                      
                      <tr>
                        <td><b><%= index+1 %> </b></td>
                        <td id="title"><%= category.title %> </td>
                        <td><%= category.description %> </td>
                        <td class="text-end">
                          <button
                            onclick="list('<%=category._id%>', '<%=category.isListed%>','<%=category.title %>')"
                            id="list"
                            data-id=""

                            class="btn btn-dark font-sm me-3"
                          >
                          <%= category.isListed ? "Listed " : "Unlisted" %> 
                          
                          </button>
                          <a
                           
                            id="edit"
                            href="/admin/category/edit-category?id=<%=category._id%>"
                            class="btn btn-outline-dark font-sm"
                          >
                            Edit
                        </a>
                        </td>
                      </tr>
                    <%})%>

                      <%}else{%>
                      <tr>
                        <td colspan="5">No cetagory found</td>
                      </tr>
                     <%}%>
                    </tbody>
                  </table>
                </div>
                <!-- table-responsive.// -->
              </div>
              <!-- col end// -->

              <!-- col end// -->
            </div>
            <!-- row end// -->
          </div>
          <!-- card-body // -->
        </div>
        <!-- card end// -->
        <div class="pagination-area mt-15 mb-50">
          <nav aria-label="Page navigation example">
            <ul class="pagination">
              
              <a class="page-link" href="?page="
                ><i class="material-icons md-chevron_left"></i
              ></a>
              
              <li class="page-item" >
                <a class="page-link" href="?page="></a>
              </li>
              
              <li class="page-item disabled">
                <span class="page-link">...</span>
              </li>
              
              <a class="page-link" href="?page="
                ><i class="material-icons md-chevron_right"></i
              ></a>
              
            </ul>
          </nav>
        </div>
      </section>
      <%- include('../partials/adminFooter.ejs') -%>
    </main>
    
    <script src="/assets/js/vendors/jquery-3.6.0.min.js"></script>
    <script src="/assets/js/vendors/bootstrap.bundle.min.js"></script>
    <script src="/assets/js/vendors/select2.min.js"></script>
    <script src="/assets/js/vendors/perfect-scrollbar.js"></script>
    <script src="/assets/js/vendors/jquery.fullscreen.min.js"></script>

    <!-- Main Script -->
    <script src="/assets/js/main.js?v=1.1" type="text/javascript"></script>
  </div>
  </body>
</html>

<script>
  // function openModal() {
  //   document.getElementById("myModal").style.display = "flex";
  // }

  // function closeModal() {
  //   document.getElementById("myModal").style.display = "none";
  // }

  

  function list(id,isListed,title) {
    const data = { data: id };
    console.log(data);
    let status = isListed ? 'Unlist' : 'List'
    if (data) {
      Swal.fire({
        title: "Are you sure",
        text: `You want to ${status} ${title}`,
        icon: "warning",
        showCancelButton: true,
        confirmButtonColor: "#3085d6",
        cancelButtonColor: "#d33",
        confirmButtonText: "Yes!",
      })
        .then((res) => {
          if (res.isConfirmed) {
            console.log("ajax");
            $.ajax({
              type: "POST",
              url: "/admin/category/listUnlist-category",
              data: JSON.stringify(data),
              contentType: "application/JSON",
              success: (res) => {
                if (res.listed) {
                  $("#AreaReload").load("category #AreaReload");
                }
              },
            });
          } else {
            console.log("Error in list");
          }
        })
        .catch((err) => {
          console.log(err);
        });
    }
  }

  function edit(value, id) {
    document.getElementById("editmodal").style.display = "flex";
    const btn = document.getElementById("edit");

    console.log(value);
    console.log(id);
    const idInput = document.getElementById("id");
    const input = document.getElementById("editFeild");
    input.value = value;
    idInput.value = id;
  }

  function closeUpdate() {
    document.getElementById("editmodal").style.display = "none";
  }

  function editCetagory() {
    const id = document.getElementById("id");
    const input = document.getElementById("editFeild");

    var data = {
      id: id.value,
      data: input.value,
    };

    console.log(input.value, "POST");

    if (data) {
      $.ajax({
        type: "POST",
        url: "/admin/editCetagory",
        data: JSON.stringify(data),
        contentType: "application/JSON",
        success: (res) => {
          if (res.updated) {
            $("#AreaReload").load("/admin/cetagory #AreaReload");
          } else if (res.fail) {
            Swal.fire({
              title: "Same name is not allowed",
              icon: "error",
              showConformButton: false,
              timer: 1500,
            });
          } else {
            return console.log("error");
          }
        },
      });
    } else {
      console.log("did not received data from edit cetagory");
    }
    closeUpdate();
  }
</script>

<!-- <script>
    document.addEventListener('DOMContentLoaded', function () {
      let searchInput=document.getElementById('searchInput');
  
      searchInput.addEventListener('keyup', function () {
        let searchTerm = searchInput.value.toLowerCase();
        let tableRows = document.querySelectorAll('#catTable tbody tr');
        console.log(tableRows)
          if(tableRows.length === 0) {
            console.log('ree')
            const tr = document.createElement('tr')
            const td = document.createElement('td');
            tr.setAttribute('colspan', '4');
            td.classList.add('text-center')
            td.innerHTML= 'no result'
            tr.appendChild(td)
            document.querySelector('#catTable tbody').appendChild(tr)
          }
        tableRows.forEach((row) => {
          
          let nameColumn = row.querySelector('td:nth-child(2) '); // Adjust the index based on your table structure
  
          if (nameColumn) {
            let nameText = nameColumn.textContent.toLowerCase();
            row.style.display = nameText.includes(searchTerm) ? '' : 'none';
          }
        });
      });
    });
  </script> -->
<script>
  document.addEventListener("DOMContentLoaded", function () {
    let searchInput = document.getElementById("searchInput");
    let noResultRow = document.createElement("tr");

    // Create the "no result found" row
    noResultRow.innerHTML =
      '<td colspan="4" class="text-center">No result found</td>';
    noResultRow.style.display = "none";
    noResultRow.style.fontSize = "20px";
    document.querySelector("#catTable tbody").appendChild(noResultRow);

    searchInput.addEventListener("keyup", function () {
      let searchTerm = searchInput.value.toLowerCase();
      let tableRows = document.querySelectorAll("#catTable tbody tr");

      let hasResults = false;

      tableRows.forEach((row) => {
        let nameColumn = row.querySelector("td:nth-child(2)"); // Adjust the index based on your table structure

        if (nameColumn) {
          let nameText = nameColumn.textContent.toLowerCase();
          row.style.display = nameText.includes(searchTerm) ? "" : "none";

          // Check if there are matching results
          if (nameText.includes(searchTerm)) {
            hasResults = true;
          }
        }
      });

      // Toggle the display of the "no result found" row based on search results
      noResultRow.style.display = hasResults ? "none" : "block";
    });
  });
</script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
