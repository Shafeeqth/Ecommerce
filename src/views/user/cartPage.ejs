        <%-include('../partials/userHeader')%>

        <main class="main">
        	<div class="page-header text-center" style="background-image: url('assets/images/page-header-bg.jpg')">
        		<div class="container">
        			<h1 class="page-title">Cart</h1>
        		</div><!-- End .container -->
        	</div><!-- End .page-header -->
            <nav aria-label="breadcrumb" class="breadcrumb-nav m-1">
                <div class="container">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="/api/v1/">Home</a></li>
                        <li class="breadcrumb-item"><a href="/api/v1/shop">Shop</a></li>
                        <li class="breadcrumb-item active" aria-current="page">Cart</li>
                    </ol>
                </div><!-- End .container -->
            </nav><!-- End .breadcrumb-nav -->

            <div class="page-content" >
            	<div class="cart" id="Reload">
	                <div class="container">
	                	<div class="row" >
	                		<div class="col-lg-9">
	                			<table class="table table-cart table-mobile">
									<thead>
										<tr>
											<th>Product</th>
											<th>Price</th>
											<th>Quantity</th>
											<th>Total</th>
											<th></th>
										</tr>
									</thead>

									<tbody>
										<%let grandTotal = 0%>
										<%if(Array.isArray(cart.products) && cart.products.length >0 ) {%>
											<%cart.products.forEach(cart => {%>
												<%let total = cart.product.price * cart.quantity ;%>
												
												

											
										<tr>
											<td class="product-col">
												<div class="product">
													<figure class="product-media">
														<a href="/product-detail?id=<%=cart.product._id%>">
															<img class="img-lg" src="/Data//uploads/<%=cart.product.images[0]%>" alt="Product image">
														</a>
													</figure>

													<h3 class="product-title">
														<a href="/product-detail?id=<%=cart.product._id%>"><%= cart.product.title%></a>
													</h3><!-- End .product-title -->
													
											
														<input disabled class=" bg-light text-center mx-5 p-2 text-dark" style="width: 20%; border: none;" type="text" id="<%=cart.product._id%>"  value="<%=cart.size%>">
														
													
												</div><!-- End .product -->
												
											</td>
											
											<td class="price-col">₹<%=cart.product.price%>.00</td>
											<td class="quantity-col">
                                                <div class="cart-product-quantity">
                                                    <input onchange="changeCount('<%=cart._id%>','<%=cart.product._id%>','<%=cart.size%>')" id="<%=cart._id%>" type="number" class="countControl form-control" value="<%=cart.quantity%>" min="1"  max="6" step="1" data-decimals="0" required>
                                                </div><!-- End .cart-product-quantity -->
                                            </td>
											
											<td class="total-col">₹<%= total%>.00</td>
											<td class="remove-col"><button onclick="removeFromCart('<%=cart._id%>','<%=cart.size%>')" class="btn-remove"><i class="icon-close"></i></button></td>
										</tr>
										<% grandTotal += total %>
										<%})%>

										<%}else{%>
											<tr class="h-100">
												<td colspan="5">
													<p class="text-center ">Your cart is empty please add items to the cart.</p>
												</td>
											</tr>
											

											<%}%>
										
										
									</tbody>
								</table><!-- End .table table-wishlist -->

								<!-- Button trigger modal -->

  <!-- Modal -->
  <div id="message-main" >
	<p id="text-span">Delivery charge</p>
  <div class="message-container">
	<div class="message-box">
	  <span id="message-number">5</span>
	</div>
  </div>
</div>

  <style>
	#message-main {
		visibility: hidden;
		z-index: 15;
		position: absolute;
		top: 27%;
		right:-41%;
		display: flex;
		width: 250px;
		height: 75px;
		background-color: #63c2af;
		border-radius: 10px;
		justify-content: space-evenly;
		align-items: center;
		transition: ease-in-out;

	}
	#text-span{
		font-weight: 400;
		font-size: medium;
		color: #ffffff;

	}
	.message-container {
		position: relative;
		width:30px;
		height: 30px;

	}

	.message-box {
		position: absolute;
		top: -75%;
		left: -47%;
		background-color: #138f76;
		color: white;
		border-radius: 50%;
		width: 250%;
		height: 250%;
		display: flex;
		justify-content: center;
		align-items: center;
		font-size: 14px;
	}

	#message-number {
		font-weight: bold;
		font-size: large;

	}

  </style>
  
<button type="button" onclick="findDeliveryCharge(event)" data-id="good" style="position: absolute; top: 56%; right: -41%; width: 5px; height: 30px; z-index: 10;" class="btn btn-lg btn-primary">Check</button>
	                			<div class="cart-bottom">
			            			
			            			<a href="/api/v1/shop" class="btn btn-outline-dark-2"><span>ADD ITEMS TO CART</span><i class="icon-refresh"></i></a>
		            			</div><!-- End .cart-bottom -->
	                		</div><!-- End .col-lg-9 -->
	                		<aside class="col-lg-3">
	                			<div class="summary summary-cart">
	                				<h3 class="summary-title">Cart Total</h3><!-- End .summary-title -->

	                				<table class="table table-summary">
	                					<tbody>
	                						<tr class="summary-subtotal">
	                							<td>Subtotal:</td>
	                							<td>₹<%= grandTotal %>.00</td>
	                						</tr><!-- End .summary-subtotal -->
	                						<tr class="summary-shipping">
	                							<td>Shipping:</td>
	                							<td>&nbsp;</td>
	                						</tr>
											<%if((grandTotal > 4999) ) {%>

	                						<tr class="summary-shipping-row">
	                							<td>
													<div class="my-3 custom-control custom-radio">
														<input type="radio" id="free-shipping" name="shipping" class="custom-control-input">
														<label class=" custom-control-label" for="free-shipping">Free Shipping</label>
													</div><!-- End .custom-control -->
	                							</td>
	                							<td>₹0.00</td>
	                						</tr><!-- End .summary-shipping-row -->
											<%}else{%>

	                						<tr id="output-div" class="summary-shipping-row text-primary" style="display: none;">
	                							<td>
	                								<div class="custom-control custom-">
														
														<label class="custom-control" for="standart-shipping">Delivery charge  :  </label>
														

													</div><!-- End .custom-control -->
	                							</td>
	                							<td>₹ <span id="output-span"></span>.00</td>
	                						</tr><!-- End .summary-shipping-row -->

	                						
											
	                						<tr class="summary-shipping-estimate " style="width: 80%;">
	                							<td style="position: relative;">
													<div class="text-danger" id="pincodeError" style="position: absolute; top:0%; left:11%">
													</div>
													 <a> Estimate delivery cost<br><input id="deliveryCharge" onkeypress="findDeliveryCharge(event)" class="" style="all: unset; margin-left: 2%;" type="text"></a>
													</td> <br>
													
	                							<td></td>
	                						</tr>
											<div class="row d-none">
												<div>
													it is my delivery charge

												</div>

											</div>

	                						<tr class="summary-total">
	                							<td>Total:</td>
	                							<td>₹<%= grandTotal %>.00</td>
	                						</tr><!-- End .summary-total -->
											<%}%>
	                					</tbody>
	                				</table><!-- End .table table-summary -->
									<%if(grandTotal > 0) {%>

	                				<a href="/api/v1/checkout" class="btn btn-outline-primary-2 btn-order btn-block">PROCEED TO CHECKOUT</a>
									<%}%>
	                			</div><!-- End .summary -->

		            			<a href="/api/v1/shop" class="btn btn-outline-dark-2 btn-block mb-3"><span>CONTINUE SHOPPING</span><i class="icon-refresh"></i></a>
	                		</aside><!-- End .col-lg-3 -->
	                	</div><!-- End .row -->
	                </div><!-- End .container -->
                </div><!-- End .cart -->
            </div><!-- End .page-content -->
        </main><!-- End .main -->
		
        <%-include('../partials/userFooter')%>



   
</body>
<script>
	function findDeliveryCharge(event) {
		if( event.key == 'Enter' || event.keyCode == 13 ||
		event.target.dataset?.id == 'good'){
			let showDelivery = document.getElementById('delivery-span');
			let outerDelivery = document.getElementById('delivery-outer')
			let element = document.getElementById("deliveryCharge");
			let pincode = element.value
			let pincodeError = document.getElementById('pincodeError');
			let messageMain = document.getElementById('message-main');
			let messageNumber = document.getElementById('message-number');
			let outputSpan = document.getElementById('output-span');
			let outputDiv = document.getElementById('output-div');
			
			if(pincode.trim().length != 6 ||
			isNaN(Number(pincode))
			) {
				
				pincodeError.innerText = 'invalid pincode'
				setTimeout(() => {
					element.style.border = '';
					pincodeError.innerText = '';
					
				}, 2000);
				return false
					
			}

			fetch('/api/v1/find-delivery-charge', {
				method : "POST",
				body : JSON.stringify({pincode}),
				headers: {
          			'Content-Type': 'application/json',

   					   }
				
			})
			.then(response => response.json())
			.then(data => {
				if(data.success) {
				messageMain.style.visibility = 'visible'
				messageNumber.innerHTML = `<b> ${data.data}</b>`;
				outputDiv.style.display = 'block';
				outputSpan.innerHTML = `${data.data}`


				setTimeout(() => {
					messageMain.style.visibility = 'hidden'
				messageNumber.innerHTML = ``
					
				}, 2000);
			}

			})

		}
		

	}
</script>


<!-- molla/cart.html  22 Nov 2019 09:55:06 GMT -->
</html>